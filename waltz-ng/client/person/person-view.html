<div>
    <!-- HEADER -->
    <waltz-page-header icon="user" name="{{ ctrl.person.displayName }}">
        <ol class="waltz-breadcrumbs">
            <li><a ui-sref="main">Home</a></li>
            <li><a ui-sref="main.person">People</a></li>
            <li>{{ ctrl.person.displayName }}</li>
        </ol>
    </waltz-page-header>


    <!-- SUMMARY -->
    <waltz-person-summary person="ctrl.person"
                          asset-costs="ctrl.assetCostData.stats"
                          managers="ctrl.managers"
                          complexity="ctrl.complexity"
                          server-stats="ctrl.techStats.serverStats"
                          directs="ctrl.directs"
                          applications="ctrl.apps"
                          flows="ctrl.dataFlows.stats">

    </waltz-person-summary>


    <!-- CHANGE INITIATIVES -->
    <waltz-section name="Change Initiatives"
                   icon="paper-plane-o">

        <waltz-source-data-section-addon ratings="ctrl.sourceDataRatings"
                                         entities="['CHANGE_INITIATIVE', 'INVOLVEMENT']">
        </waltz-source-data-section-addon>

        <waltz-change-initiative-table ng-if='ctrl.changeInitiatives.length > 0'
                                       list="ctrl.changeInitiatives">
        </waltz-change-initiative-table>

        <div class="alert alert-warning" ng-if="ctrl.changeInitiatives.length == 0">
            <strong>This person is not associated with any Change Initiatives</strong>
        </div>

    </waltz-section>


    <!-- APPS -->
    <div ng-if="ctrl.hasAppInvolvements">

        <waltz-section icon="desktop"
                       name="Application Portfolio">

            <waltz-source-data-section-addon ratings="ctrl.sourceDataRatings"
                                     entities="['APPLICATION', 'INVOLVEMENT']">
            </waltz-source-data-section-addon>

            <uib-tabset>

                <uib-tab heading="Summary">
                    <div class="row">
                        <div class="col-sm-6">
                            <div>
                                <waltz-pie-table data="ctrl.charts.apps.byLifecyclePhase.data"
                                                 config="ctrl.charts.apps.byLifecyclePhase.config"
                                                 title="Applications By Lifecycle Phase">
                                </waltz-pie-table>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div>
                                <waltz-pie-table data="ctrl.charts.apps.byKind.data"
                                                 config="ctrl.charts.apps.byKind.config"
                                                 title="Applications By Type">
                                </waltz-pie-table>
                            </div>
                        </div>
                    </div>
                </uib-tab>


                <uib-tab select="showDirectTab = true"
                         heading="Direct"
                         ng-if="ctrl.appInvolvements.direct.length > 0">

                    <div ng-if="showDirectTab"
                         ng-repeat="group in ctrl.appInvolvements.direct | orderBy:'kind'">
                        <h4>
                            Role: {{group.kind | toDisplayName:'involvementKind'}}
                        </h4>

                        <waltz-app-table applications="group.apps">
                        </waltz-app-table>
                    </div>

                </uib-tab>


                <uib-tab select="showOversightTab=true"
                         heading="Oversight"
                         ng-if="ctrl.appInvolvements.indirect.length > 0">

                    <div ng-if="showOversightTab">
                        <h4> Oversight Involvements <small>(Inferred via direct reports)</small></h4>
                        <waltz-app-table applications="ctrl.appInvolvements.indirect">
                        </waltz-app-table>
                    </div>

                </uib-tab>

            </uib-tabset>

        </waltz-section>


        <!-- END USER APPS -->
        <div ng-if="ctrl.hasEndUserAppInvolvements">

            <waltz-section icon="desktop"
                           name="End User Application Portfolio">

                <waltz-source-data-section-addon ratings="ctrl.sourceDataRatings"
                                                 entities="['END_USER_APPLICATION', 'INVOLVEMENT']">
                </waltz-source-data-section-addon>

                <uib-tabset>

                    <uib-tab heading="Summary">
                        <div class="row">
                            <div class="col-sm-6">
                                <div>
                                    <waltz-pie-table data="ctrl.charts.endUserApps.byLifecyclePhase.data"
                                                     config="ctrl.charts.endUserApps.byLifecyclePhase.config"
                                                     title="Applications By Lifecycle Phase">
                                    </waltz-pie-table>
                                </div>
                            </div>
                            <div class="col-sm-6">
                                <div>
                                    <waltz-pie-table data="ctrl.charts.endUserApps.byKind.data"
                                                     config="ctrl.charts.endUserApps.byKind.config"
                                                     title="Applications By Type">
                                    </waltz-pie-table>
                                </div>
                            </div>
                        </div>
                    </uib-tab>


                    <uib-tab select="showDirectTab = true"
                             heading="Direct"
                             ng-if="ctrl.endUserAppInvolvements.direct.length > 0">

                        <div ng-if="showDirectTab"
                             ng-repeat="group in ctrl.endUserAppInvolvements.direct | orderBy:'kind'">
                            <h4>
                                Role: {{group.kind | toDisplayName:'involvementKind'}}
                            </h4>

                            <waltz-app-table applications="group.apps">
                            </waltz-app-table>
                        </div>

                    </uib-tab>


                    <uib-tab select="showOversightTab=true"
                             heading="Oversight"
                             ng-if="ctrl.endUserAppInvolvements.indirect.length > 0">

                        <div ng-if="showOversightTab">
                            <h4> Oversight Involvements <small>(Inferred via direct reports)</small></h4>
                            <waltz-app-table applications="ctrl.endUserAppInvolvements.indirect">
                            </waltz-app-table>
                        </div>

                    </uib-tab>

                </uib-tabset>

            </waltz-section>


        <!-- COMPLEXITY -->
        <waltz-complexity-section complexity="ctrl.complexity"
                                  apps="ctrl.apps">
        </waltz-complexity-section>


        <!-- FLOWS -->
        <waltz-data-flows-tabgroup-section ratings="ctrl.sourceDataRatings"
                                           flow-data="ctrl.dataFlows"
                                           on-load-detail="ctrl.loadFlowDetail"
                                           applications="ctrl.apps">

        </waltz-data-flows-tabgroup-section>


        <!-- TECHNOLOGIES -->
        <waltz-section name="Technologies">

            <waltz-source-data-section-addon ratings="ctrl.sourceDataRatings"
                                             entities="['SERVER', 'DATABASE', 'SOFTWARE']">
            </waltz-source-data-section-addon>

            <waltz-group-technology-summary stats="ctrl.techStats">
            </waltz-group-technology-summary>
        </waltz-section>


        <!-- COSTS -->
        <waltz-asset-costs-section data="ctrl.assetCostData"
                                   on-bucket-select="ctrl.onAssetBucketSelect"
                                   source-data-ratings="ctrl.sourceDataRatings">
        </waltz-asset-costs-section>


    </div>

</div>
